CREATE SCHEMA vivienda;

CREATE TABLE IF NOT EXISTS comunidad_anio (
    comunidad VARCHAR(25) NOT NULL,
    anio YEAR NOT NULL,
    PRIMARY KEY (comunidad, anio),
    CONSTRAINT anio CHECK (anio BETWEEN 2000 AND 2100)
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS coste_vivienda (
    comunidad VARCHAR(25) NOT NULL,
    anio YEAR NOT NULL,
    coste_medio FLOAT,
    PRIMARY KEY (comunidad, anio),
    FOREIGN KEY (comunidad, anio) REFERENCES comunidad_anio ON DELETE CASCADE
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS salarios (
    comunidad VARCHAR(25) NOT NULL,
    anio YEAR NOT NULL,
    salario_mediana FLOAT,
    PRIMARY KEY (comunidad, anio),
    FOREIGN KEY (comunidad, anio) REFERENCES comunidad_anio ON DELETE CASCADE
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS censo (
    comunidad VARCHAR(25) NOT NULL,
    anio YEAR NOT NULL,
    poblacion INT NOT NULL,
    PRIMARY KEY (comunidad, anio),
    FOREIGN KEY (comunidad, anio) REFERENCES comunidad_anio ON DELETE CASCADE
)ENGINE=InnoDB;

TRUNCATE TABLE censo;

CREATE TABLE IF NOT EXISTS hipotecas (
    comunidad VARCHAR(25) NOT NULL,
    anio YEAR NOT NULL,
    n_hipotecas INT UNSIGNED NOT NULL,
    PRIMARY KEY (comunidad, anio),
    FOREIGN KEY (comunidad, anio) REFERENCES comunidad_anio ON DELETE CASCADE
)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS ipc (
    comunidad VARCHAR(25) NOT NULL,
    anio YEAR NOT NULL,
    ipc FLOAT,
    PRIMARY KEY (comunidad, anio),
    FOREIGN KEY (comunidad, anio) REFERENCES comunidad_anio ON DELETE CASCADE
)ENGINE=InnoDB;

TRUNCATE TABLE coste_vivienda;

INSERT INTO comunidad_anio (comunidad, anio) VALUES
('Andalucia', 2000),
('Andalucia', 2001),
('Andalucia', 2002),
('Andalucia', 2003),
('Andalucia', 2004),
('Andalucia', 2005),
('Andalucia', 2006),
('Andalucia', 2007),
('Andalucia', 2008),
('Andalucia', 2009),
('Andalucia', 2010),
('Andalucia', 2011),
('Andalucia', 2012),
('Andalucia', 2013),
('Andalucia', 2014),
('Andalucia', 2015),
('Andalucia', 2016),
('Andalucia', 2017),
('Andalucia', 2018),
('Andalucia', 2019),
('Andalucia', 2020),
('Andalucia', 2021),
('Andalucia', 2022),
('Andalucia', 2023),
('Andalucia', 2024),
('Andalucia', 2025),
('Andalucia', 2026),
('Andalucia', 2027),
('Andalucia', 2028),
('Andalucia', 2029),
('Andalucia', 2030),
('Andalucia', 2031),
('Andalucia', 2032),
('Andalucia', 2033),
('Andalucia', 2034),
('Andalucia', 2035),
('Andalucia', 2036),
('Andalucia', 2037),
('Andalucia', 2038),
('Andalucia', 2039),
('Andalucia', 2040),
('Andalucia', 2041),
('Andalucia', 2042),
('Andalucia', 2043),
('Andalucia', 2044),
('Andalucia', 2045),
('Andalucia', 2046),
('Andalucia', 2047),
('Andalucia', 2048),
('Andalucia', 2049),
('Andalucia', 2050),
('Aragon', 2000),
('Aragon', 2001),
('Aragon', 2002),
('Aragon', 2003),
('Aragon', 2004),
('Aragon', 2005),
('Aragon', 2006),
('Aragon', 2007),
('Aragon', 2008),
('Aragon', 2009),
('Aragon', 2010),
('Aragon', 2011),
('Aragon', 2012),
('Aragon', 2013),
('Aragon', 2014),
('Aragon', 2015),
('Aragon', 2016),
('Aragon', 2017),
('Aragon', 2018),
('Aragon', 2019),
('Aragon', 2020),
('Aragon', 2021),
('Aragon', 2022),
('Aragon', 2023),
('Aragon', 2024),
('Aragon', 2025),
('Aragon', 2026),
('Aragon', 2027),
('Aragon', 2028),
('Aragon', 2029),
('Aragon', 2030),
('Aragon', 2031),
('Aragon', 2032),
('Aragon', 2033),
('Aragon', 2034),
('Aragon', 2035),
('Aragon', 2036),
('Aragon', 2037),
('Aragon', 2038),
('Aragon', 2039),
('Aragon', 2040),
('Aragon', 2041),
('Aragon', 2042),
('Aragon', 2043),
('Aragon', 2044),
('Aragon', 2045),
('Aragon', 2046),
('Aragon', 2047),
('Aragon', 2048),
('Aragon', 2049),
('Aragon', 2050),
('Asturias', 2000),
('Asturias', 2001),
('Asturias', 2002),
('Asturias', 2003),
('Asturias', 2004),
('Asturias', 2005),
('Asturias', 2006),
('Asturias', 2007),
('Asturias', 2008),
('Asturias', 2009),
('Asturias', 2010),
('Asturias', 2011),
('Asturias', 2012),
('Asturias', 2013),
('Asturias', 2014),
('Asturias', 2015),
('Asturias', 2016),
('Asturias', 2017),
('Asturias', 2018),
('Asturias', 2019),
('Asturias', 2020),
('Asturias', 2021),
('Asturias', 2022),
('Asturias', 2023),
('Asturias', 2024),
('Asturias', 2025),
('Asturias', 2026),
('Asturias', 2027),
('Asturias', 2028),
('Asturias', 2029),
('Asturias', 2030),
('Asturias', 2031),
('Asturias', 2032),
('Asturias', 2033),
('Asturias', 2034),
('Asturias', 2035),
('Asturias', 2036),
('Asturias', 2037),
('Asturias', 2038),
('Asturias', 2039),
('Asturias', 2040),
('Asturias', 2041),
('Asturias', 2042),
('Asturias', 2043),
('Asturias', 2044),
('Asturias', 2045),
('Asturias', 2046),
('Asturias', 2047),
('Asturias', 2048),
('Asturias', 2049),
('Asturias', 2050),
('Islas Baleares', 2000),
('Islas Baleares', 2001),
('Islas Baleares', 2002),
('Islas Baleares', 2003),
('Islas Baleares', 2004),
('Islas Baleares', 2005),
('Islas Baleares', 2006),
('Islas Baleares', 2007),
('Islas Baleares', 2008),
('Islas Baleares', 2009),
('Islas Baleares', 2010),
('Islas Baleares', 2011),
('Islas Baleares', 2012),
('Islas Baleares', 2013),
('Islas Baleares', 2014),
('Islas Baleares', 2015),
('Islas Baleares', 2016),
('Islas Baleares', 2017),
('Islas Baleares', 2018),
('Islas Baleares', 2019),
('Islas Baleares', 2020),
('Islas Baleares', 2021),
('Islas Baleares', 2022),
('Islas Baleares', 2023),
('Islas Baleares', 2024),
('Islas Baleares', 2025),
('Islas Baleares', 2026),
('Islas Baleares', 2027),
('Islas Baleares', 2028),
('Islas Baleares', 2029),
('Islas Baleares', 2030),
('Islas Baleares', 2031),
('Islas Baleares', 2032),
('Islas Baleares', 2033),
('Islas Baleares', 2034),
('Islas Baleares', 2035),
('Islas Baleares', 2036),
('Islas Baleares', 2037),
('Islas Baleares', 2038),
('Islas Baleares', 2039),
('Islas Baleares', 2040),
('Islas Baleares', 2041),
('Islas Baleares', 2042),
('Islas Baleares', 2043),
('Islas Baleares', 2044),
('Islas Baleares', 2045),
('Islas Baleares', 2046),
('Islas Baleares', 2047),
('Islas Baleares', 2048),
('Islas Baleares', 2049),
('Islas Baleares', 2050),
('Canarias', 2000),
('Canarias', 2001),
('Canarias', 2002),
('Canarias', 2003),
('Canarias', 2004),
('Canarias', 2005),
('Canarias', 2006),
('Canarias', 2007),
('Canarias', 2008),
('Canarias', 2009),
('Canarias', 2010),
('Canarias', 2011),
('Canarias', 2012),
('Canarias', 2013),
('Canarias', 2014),
('Canarias', 2015),
('Canarias', 2016),
('Canarias', 2017),
('Canarias', 2018),
('Canarias', 2019),
('Canarias', 2020),
('Canarias', 2021),
('Canarias', 2022),
('Canarias', 2023),
('Canarias', 2024),
('Canarias', 2025),
('Canarias', 2026),
('Canarias', 2027),
('Canarias', 2028),
('Canarias', 2029),
('Canarias', 2030),
('Canarias', 2031),
('Canarias', 2032),
('Canarias', 2033),
('Canarias', 2034),
('Canarias', 2035),
('Canarias', 2036),
('Canarias', 2037),
('Canarias', 2038),
('Canarias', 2039),
('Canarias', 2040),
('Canarias', 2041),
('Canarias', 2042),
('Canarias', 2043),
('Canarias', 2044),
('Canarias', 2045),
('Canarias', 2046),
('Canarias', 2047),
('Canarias', 2048),
('Canarias', 2049),
('Canarias', 2050),
('Cantabria', 2000),
('Cantabria', 2001),
('Cantabria', 2002),
('Cantabria', 2003),
('Cantabria', 2004),
('Cantabria', 2005),
('Cantabria', 2006),
('Cantabria', 2007),
('Cantabria', 2008),
('Cantabria', 2009),
('Cantabria', 2010),
('Cantabria', 2011),
('Cantabria', 2012),
('Cantabria', 2013),
('Cantabria', 2014),
('Cantabria', 2015),
('Cantabria', 2016),
('Cantabria', 2017),
('Cantabria', 2018),
('Cantabria', 2019),
('Cantabria', 2020),
('Cantabria', 2021),
('Cantabria', 2022),
('Cantabria', 2023),
('Cantabria', 2024),
('Cantabria', 2025),
('Cantabria', 2026),
('Cantabria', 2027),
('Cantabria', 2028),
('Cantabria', 2029),
('Cantabria', 2030),
('Cantabria', 2031),
('Cantabria', 2032),
('Cantabria', 2033),
('Cantabria', 2034),
('Cantabria', 2035),
('Cantabria', 2036),
('Cantabria', 2037),
('Cantabria', 2038),
('Cantabria', 2039),
('Cantabria', 2040),
('Cantabria', 2041),
('Cantabria', 2042),
('Cantabria', 2043),
('Cantabria', 2044),
('Cantabria', 2045),
('Cantabria', 2046),
('Cantabria', 2047),
('Cantabria', 2048),
('Cantabria', 2049),
('Cantabria', 2050),
('Castilla y Leon', 2000),
('Castilla y Leon', 2001),
('Castilla y Leon', 2002),
('Castilla y Leon', 2003),
('Castilla y Leon', 2004),
('Castilla y Leon', 2005),
('Castilla y Leon', 2006),
('Castilla y Leon', 2007),
('Castilla y Leon', 2008),
('Castilla y Leon', 2009),
('Castilla y Leon', 2010),
('Castilla y Leon', 2011),
('Castilla y Leon', 2012),
('Castilla y Leon', 2013),
('Castilla y Leon', 2014),
('Castilla y Leon', 2015),
('Castilla y Leon', 2016),
('Castilla y Leon', 2017),
('Castilla y Leon', 2018),
('Castilla y Leon', 2019),
('Castilla y Leon', 2020),
('Castilla y Leon', 2021),
('Castilla y Leon', 2022),
('Castilla y Leon', 2023),
('Castilla y Leon', 2024),
('Castilla y Leon', 2025),
('Castilla y Leon', 2026),
('Castilla y Leon', 2027),
('Castilla y Leon', 2028),
('Castilla y Leon', 2029),
('Castilla y Leon', 2030),
('Castilla y Leon', 2031),
('Castilla y Leon', 2032),
('Castilla y Leon', 2033),
('Castilla y Leon', 2034),
('Castilla y Leon', 2035),
('Castilla y Leon', 2036),
('Castilla y Leon', 2037),
('Castilla y Leon', 2038),
('Castilla y Leon', 2039),
('Castilla y Leon', 2040),
('Castilla y Leon', 2041),
('Castilla y Leon', 2042),
('Castilla y Leon', 2043),
('Castilla y Leon', 2044),
('Castilla y Leon', 2045),
('Castilla y Leon', 2046),
('Castilla y Leon', 2047),
('Castilla y Leon', 2048),
('Castilla y Leon', 2049),
('Castilla y Leon', 2050),
('Castilla La Mancha', 2000),
('Castilla La Mancha', 2001),
('Castilla La Mancha', 2002),
('Castilla La Mancha', 2003),
('Castilla La Mancha', 2004),
('Castilla La Mancha', 2005),
('Castilla La Mancha', 2006),
('Castilla La Mancha', 2007),
('Castilla La Mancha', 2008),
('Castilla La Mancha', 2009),
('Castilla La Mancha', 2010),
('Castilla La Mancha', 2011),
('Castilla La Mancha', 2012),
('Castilla La Mancha', 2013),
('Castilla La Mancha', 2014),
('Castilla La Mancha', 2015),
('Castilla La Mancha', 2016),
('Castilla La Mancha', 2017),
('Castilla La Mancha', 2018),
('Castilla La Mancha', 2019),
('Castilla La Mancha', 2020),
('Castilla La Mancha', 2021),
('Castilla La Mancha', 2022),
('Castilla La Mancha', 2023),
('Castilla La Mancha', 2024),
('Castilla La Mancha', 2025),
('Castilla La Mancha', 2026),
('Castilla La Mancha', 2027),
('Castilla La Mancha', 2028),
('Castilla La Mancha', 2029),
('Castilla La Mancha', 2030),
('Castilla La Mancha', 2031),
('Castilla La Mancha', 2032),
('Castilla La Mancha', 2033),
('Castilla La Mancha', 2034),
('Castilla La Mancha', 2035),
('Castilla La Mancha', 2036),
('Castilla La Mancha', 2037),
('Castilla La Mancha', 2038),
('Castilla La Mancha', 2039),
('Castilla La Mancha', 2040),
('Castilla La Mancha', 2041),
('Castilla La Mancha', 2042),
('Castilla La Mancha', 2043),
('Castilla La Mancha', 2044),
('Castilla La Mancha', 2045),
('Castilla La Mancha', 2046),
('Castilla La Mancha', 2047),
('Castilla La Mancha', 2048),
('Castilla La Mancha', 2049),
('Castilla La Mancha', 2050),
('Catalunya', 2000),
('Catalunya', 2001),
('Catalunya', 2002),
('Catalunya', 2003),
('Catalunya', 2004),
('Catalunya', 2005),
('Catalunya', 2006),
('Catalunya', 2007),
('Catalunya', 2008),
('Catalunya', 2009),
('Catalunya', 2010),
('Catalunya', 2011),
('Catalunya', 2012),
('Catalunya', 2013),
('Catalunya', 2014),
('Catalunya', 2015),
('Catalunya', 2016),
('Catalunya', 2017),
('Catalunya', 2018),
('Catalunya', 2019),
('Catalunya', 2020),
('Catalunya', 2021),
('Catalunya', 2022),
('Catalunya', 2023),
('Catalunya', 2024),
('Catalunya', 2025),
('Catalunya', 2026),
('Catalunya', 2027),
('Catalunya', 2028),
('Catalunya', 2029),
('Catalunya', 2030),
('Catalunya', 2031),
('Catalunya', 2032),
('Catalunya', 2033),
('Catalunya', 2034),
('Catalunya', 2035),
('Catalunya', 2036),
('Catalunya', 2037),
('Catalunya', 2038),
('Catalunya', 2039),
('Catalunya', 2040),
('Catalunya', 2041),
('Catalunya', 2042),
('Catalunya', 2043),
('Catalunya', 2044),
('Catalunya', 2045),
('Catalunya', 2046),
('Catalunya', 2047),
('Catalunya', 2048),
('Catalunya', 2049),
('Catalunya', 2050),
('Comunitat Valenciana', 2000),
('Comunitat Valenciana', 2001),
('Comunitat Valenciana', 2002),
('Comunitat Valenciana', 2003),
('Comunitat Valenciana', 2004),
('Comunitat Valenciana', 2005),
('Comunitat Valenciana', 2006),
('Comunitat Valenciana', 2007),
('Comunitat Valenciana', 2008),
('Comunitat Valenciana', 2009),
('Comunitat Valenciana', 2010),
('Comunitat Valenciana', 2011),
('Comunitat Valenciana', 2012),
('Comunitat Valenciana', 2013),
('Comunitat Valenciana', 2014),
('Comunitat Valenciana', 2015),
('Comunitat Valenciana', 2016),
('Comunitat Valenciana', 2017),
('Comunitat Valenciana', 2018),
('Comunitat Valenciana', 2019),
('Comunitat Valenciana', 2020),
('Comunitat Valenciana', 2021),
('Comunitat Valenciana', 2022),
('Comunitat Valenciana', 2023),
('Comunitat Valenciana', 2024),
('Comunitat Valenciana', 2025),
('Comunitat Valenciana', 2026),
('Comunitat Valenciana', 2027),
('Comunitat Valenciana', 2028),
('Comunitat Valenciana', 2029),
('Comunitat Valenciana', 2030),
('Comunitat Valenciana', 2031),
('Comunitat Valenciana', 2032),
('Comunitat Valenciana', 2033),
('Comunitat Valenciana', 2034),
('Comunitat Valenciana', 2035),
('Comunitat Valenciana', 2036),
('Comunitat Valenciana', 2037),
('Comunitat Valenciana', 2038),
('Comunitat Valenciana', 2039),
('Comunitat Valenciana', 2040),
('Comunitat Valenciana', 2041),
('Comunitat Valenciana', 2042),
('Comunitat Valenciana', 2043),
('Comunitat Valenciana', 2044),
('Comunitat Valenciana', 2045),
('Comunitat Valenciana', 2046),
('Comunitat Valenciana', 2047),
('Comunitat Valenciana', 2048),
('Comunitat Valenciana', 2049),
('Comunitat Valenciana', 2050),
('Extremadura', 2000),
('Extremadura', 2001),
('Extremadura', 2002),
('Extremadura', 2003),
('Extremadura', 2004),
('Extremadura', 2005),
('Extremadura', 2006),
('Extremadura', 2007),
('Extremadura', 2008),
('Extremadura', 2009),
('Extremadura', 2010),
('Extremadura', 2011),
('Extremadura', 2012),
('Extremadura', 2013),
('Extremadura', 2014),
('Extremadura', 2015),
('Extremadura', 2016),
('Extremadura', 2017),
('Extremadura', 2018),
('Extremadura', 2019),
('Extremadura', 2020),
('Extremadura', 2021),
('Extremadura', 2022),
('Extremadura', 2023),
('Extremadura', 2024),
('Extremadura', 2025),
('Extremadura', 2026),
('Extremadura', 2027),
('Extremadura', 2028),
('Extremadura', 2029),
('Extremadura', 2030),
('Extremadura', 2031),
('Extremadura', 2032),
('Extremadura', 2033),
('Extremadura', 2034),
('Extremadura', 2035),
('Extremadura', 2036),
('Extremadura', 2037),
('Extremadura', 2038),
('Extremadura', 2039),
('Extremadura', 2040),
('Extremadura', 2041),
('Extremadura', 2042),
('Extremadura', 2043),
('Extremadura', 2044),
('Extremadura', 2045),
('Extremadura', 2046),
('Extremadura', 2047),
('Extremadura', 2048),
('Extremadura', 2049),
('Extremadura', 2050),
('Galicia', 2000),
('Galicia', 2001),
('Galicia', 2002),
('Galicia', 2003),
('Galicia', 2004),
('Galicia', 2005),
('Galicia', 2006),
('Galicia', 2007),
('Galicia', 2008),
('Galicia', 2009),
('Galicia', 2010),
('Galicia', 2011),
('Galicia', 2012),
('Galicia', 2013),
('Galicia', 2014),
('Galicia', 2015),
('Galicia', 2016),
('Galicia', 2017),
('Galicia', 2018),
('Galicia', 2019),
('Galicia', 2020),
('Galicia', 2021),
('Galicia', 2022),
('Galicia', 2023),
('Galicia', 2024),
('Galicia', 2025),
('Galicia', 2026),
('Galicia', 2027),
('Galicia', 2028),
('Galicia', 2029),
('Galicia', 2030),
('Galicia', 2031),
('Galicia', 2032),
('Galicia', 2033),
('Galicia', 2034),
('Galicia', 2035),
('Galicia', 2036),
('Galicia', 2037),
('Galicia', 2038),
('Galicia', 2039),
('Galicia', 2040),
('Galicia', 2041),
('Galicia', 2042),
('Galicia', 2043),
('Galicia', 2044),
('Galicia', 2045),
('Galicia', 2046),
('Galicia', 2047),
('Galicia', 2048),
('Galicia', 2049),
('Galicia', 2050),
('Madrid', 2000),
('Madrid', 2001),
('Madrid', 2002),
('Madrid', 2003),
('Madrid', 2004),
('Madrid', 2005),
('Madrid', 2006),
('Madrid', 2007),
('Madrid', 2008),
('Madrid', 2009),
('Madrid', 2010),
('Madrid', 2011),
('Madrid', 2012),
('Madrid', 2013),
('Madrid', 2014),
('Madrid', 2015),
('Madrid', 2016),
('Madrid', 2017),
('Madrid', 2018),
('Madrid', 2019),
('Madrid', 2020),
('Madrid', 2021),
('Madrid', 2022),
('Madrid', 2023),
('Madrid', 2024),
('Madrid', 2025),
('Madrid', 2026),
('Madrid', 2027),
('Madrid', 2028),
('Madrid', 2029),
('Madrid', 2030),
('Madrid', 2031),
('Madrid', 2032),
('Madrid', 2033),
('Madrid', 2034),
('Madrid', 2035),
('Madrid', 2036),
('Madrid', 2037),
('Madrid', 2038),
('Madrid', 2039),
('Madrid', 2040),
('Madrid', 2041),
('Madrid', 2042),
('Madrid', 2043),
('Madrid', 2044),
('Madrid', 2045),
('Madrid', 2046),
('Madrid', 2047),
('Madrid', 2048),
('Madrid', 2049),
('Madrid', 2050),
('Murcia', 2000),
('Murcia', 2001),
('Murcia', 2002),
('Murcia', 2003),
('Murcia', 2004),
('Murcia', 2005),
('Murcia', 2006),
('Murcia', 2007),
('Murcia', 2008),
('Murcia', 2009),
('Murcia', 2010),
('Murcia', 2011),
('Murcia', 2012),
('Murcia', 2013),
('Murcia', 2014),
('Murcia', 2015),
('Murcia', 2016),
('Murcia', 2017),
('Murcia', 2018),
('Murcia', 2019),
('Murcia', 2020),
('Murcia', 2021),
('Murcia', 2022),
('Murcia', 2023),
('Murcia', 2024),
('Murcia', 2025),
('Murcia', 2026),
('Murcia', 2027),
('Murcia', 2028),
('Murcia', 2029),
('Murcia', 2030),
('Murcia', 2031),
('Murcia', 2032),
('Murcia', 2033),
('Murcia', 2034),
('Murcia', 2035),
('Murcia', 2036),
('Murcia', 2037),
('Murcia', 2038),
('Murcia', 2039),
('Murcia', 2040),
('Murcia', 2041),
('Murcia', 2042),
('Murcia', 2043),
('Murcia', 2044),
('Murcia', 2045),
('Murcia', 2046),
('Murcia', 2047),
('Murcia', 2048),
('Murcia', 2049),
('Murcia', 2050),
('Navarra', 2000),
('Navarra', 2001),
('Navarra', 2002),
('Navarra', 2003),
('Navarra', 2004),
('Navarra', 2005),
('Navarra', 2006),
('Navarra', 2007),
('Navarra', 2008),
('Navarra', 2009),
('Navarra', 2010),
('Navarra', 2011),
('Navarra', 2012),
('Navarra', 2013),
('Navarra', 2014),
('Navarra', 2015),
('Navarra', 2016),
('Navarra', 2017),
('Navarra', 2018),
('Navarra', 2019),
('Navarra', 2020),
('Navarra', 2021),
('Navarra', 2022),
('Navarra', 2023),
('Navarra', 2024),
('Navarra', 2025),
('Navarra', 2026),
('Navarra', 2027),
('Navarra', 2028),
('Navarra', 2029),
('Navarra', 2030),
('Navarra', 2031),
('Navarra', 2032),
('Navarra', 2033),
('Navarra', 2034),
('Navarra', 2035),
('Navarra', 2036),
('Navarra', 2037),
('Navarra', 2038),
('Navarra', 2039),
('Navarra', 2040),
('Navarra', 2041),
('Navarra', 2042),
('Navarra', 2043),
('Navarra', 2044),
('Navarra', 2045),
('Navarra', 2046),
('Navarra', 2047),
('Navarra', 2048),
('Navarra', 2049),
('Navarra', 2050),
('Pais Vasco', 2000),
('Pais Vasco', 2001),
('Pais Vasco', 2002),
('Pais Vasco', 2003),
('Pais Vasco', 2004),
('Pais Vasco', 2005),
('Pais Vasco', 2006),
('Pais Vasco', 2007),
('Pais Vasco', 2008),
('Pais Vasco', 2009),
('Pais Vasco', 2010),
('Pais Vasco', 2011),
('Pais Vasco', 2012),
('Pais Vasco', 2013),
('Pais Vasco', 2014),
('Pais Vasco', 2015),
('Pais Vasco', 2016),
('Pais Vasco', 2017),
('Pais Vasco', 2018),
('Pais Vasco', 2019),
('Pais Vasco', 2020),
('Pais Vasco', 2021),
('Pais Vasco', 2022),
('Pais Vasco', 2023),
('Pais Vasco', 2024),
('Pais Vasco', 2025),
('Pais Vasco', 2026),
('Pais Vasco', 2027),
('Pais Vasco', 2028),
('Pais Vasco', 2029),
('Pais Vasco', 2030),
('Pais Vasco', 2031),
('Pais Vasco', 2032),
('Pais Vasco', 2033),
('Pais Vasco', 2034),
('Pais Vasco', 2035),
('Pais Vasco', 2036),
('Pais Vasco', 2037),
('Pais Vasco', 2038),
('Pais Vasco', 2039),
('Pais Vasco', 2040),
('Pais Vasco', 2041),
('Pais Vasco', 2042),
('Pais Vasco', 2043),
('Pais Vasco', 2044),
('Pais Vasco', 2045),
('Pais Vasco', 2046),
('Pais Vasco', 2047),
('Pais Vasco', 2048),
('Pais Vasco', 2049),
('Pais Vasco', 2050),
('La Rioja', 2000),
('La Rioja', 2001),
('La Rioja', 2002),
('La Rioja', 2003),
('La Rioja', 2004),
('La Rioja', 2005),
('La Rioja', 2006),
('La Rioja', 2007),
('La Rioja', 2008),
('La Rioja', 2009),
('La Rioja', 2010),
('La Rioja', 2011),
('La Rioja', 2012),
('La Rioja', 2013),
('La Rioja', 2014),
('La Rioja', 2015),
('La Rioja', 2016),
('La Rioja', 2017),
('La Rioja', 2018),
('La Rioja', 2019),
('La Rioja', 2020),
('La Rioja', 2021),
('La Rioja', 2022),
('La Rioja', 2023),
('La Rioja', 2024),
('La Rioja', 2025),
('La Rioja', 2026),
('La Rioja', 2027),
('La Rioja', 2028),
('La Rioja', 2029),
('La Rioja', 2030),
('La Rioja', 2031),
('La Rioja', 2032),
('La Rioja', 2033),
('La Rioja', 2034),
('La Rioja', 2035),
('La Rioja', 2036),
('La Rioja', 2037),
('La Rioja', 2038),
('La Rioja', 2039),
('La Rioja', 2040),
('La Rioja', 2041),
('La Rioja', 2042),
('La Rioja', 2043),
('La Rioja', 2044),
('La Rioja', 2045),
('La Rioja', 2046),
('La Rioja', 2047),
('La Rioja', 2048),
('La Rioja', 2049),
('La Rioja', 2050);


-- Evolucion coste vivienda €/m2 y salarios

SELECT * 
FROM coste_vivienda 
ORDER BY anio DESC;

SELECT anio 
FROM salarios 
ORDER BY anio DESC;


-- Evolucion anual para todo el país

SELECT anio, AVG(coste_medio) AS media_anual
FROM coste_vivienda
GROUP BY anio
ORDER BY anio;

-- Evolucion anual para Madrid

SELECT anio, AVG(coste_medio) AS media_anual
FROM coste_vivienda
WHERE comunidad = 'Pais Vasco'
GROUP BY anio
ORDER BY anio;


-- % diferencia evolucion respecto burbuja de 2008 en toda España

SELECT c1.comunidad, c1.anio,
    ROUND(
        ((c1.coste_medio - c2.coste_medio) / c2.coste_medio) * 100,
        2
    ) AS variacion_pct
FROM coste_vivienda AS c1
JOIN coste_vivienda AS c2
  ON c1.comunidad = c2.comunidad
 AND c2.anio = 2008
WHERE c1.anio >= 2008
ORDER BY c1.comunidad, c1.anio;


-- % diferencia evolucion respecto burbuja de 2008 en Madrid, Cataluña y Valencia

SELECT c1.comunidad, c1.anio, c1.coste_medio,
    ROUND(
        ((c1.coste_medio - c2.coste_medio) / c2.coste_medio) * 100,
        2
    ) AS variacion_pct
FROM coste_vivienda AS c1
JOIN coste_vivienda AS c2
  ON c1.comunidad = c2.comunidad
 AND c2.anio = 2008
WHERE c1.anio >= 2008
AND c1.comunidad IN ('Madrid', 'Catalunya', 'Comunitat Valenciana')
ORDER BY c1.comunidad, c1.anio;


-- % variacion de poblacion interanual por comunidades vs 2008

SELECT 
    c.comunidad,
    c.anio,
    c.poblacion        AS poblacion_actual,
    b.poblacion_2008,
    (c.poblacion - b.poblacion_2008)                                   AS variacion_abs,
    ROUND(100.0 * (c.poblacion - b.poblacion_2008) / NULLIF(b.poblacion_2008, 0), 2) AS variacion_pct
FROM (
    SELECT comunidad, anio, CAST(poblacion AS SIGNED) AS poblacion
    FROM censo
) AS c
JOIN (
    SELECT comunidad, CAST(poblacion AS SIGNED) AS poblacion_2008
    FROM censo
    WHERE anio = 2008
) AS b
  ON b.comunidad = c.comunidad

WHERE c.anio >= 2008
ORDER BY c.comunidad, c.anio;

-- Comparativa de metricas coste, salarios, poblacion 2015 vs 2022 

SELECT 
    a.comunidad,

    -- 1️⃣ Variación % de población (2022 vs 2015)
    ROUND(100.0 * (a.poblacion - b.poblacion) / b.poblacion, 2) AS variacion_poblacion_pct,

    -- 2️⃣ Variación % de salario mediano nominal
    ROUND(100.0 * (a.salario_mediana - b.salario_mediana) / b.salario_mediana, 2) AS variacion_salario_pct,

    -- 3️⃣ Variación % del coste medio de vivienda
    ROUND(100.0 * (a.coste_medio - b.coste_medio) / b.coste_medio, 2) AS variacion_coste_vivienda_pct

FROM (
    -- Datos de 2022
    SELECT 
        c.comunidad,
        c.poblacion,
        s.salario_mediana,
        v.coste_medio
    FROM censo AS c
    JOIN salarios AS s USING (comunidad, anio)
    JOIN coste_vivienda AS v USING (comunidad, anio)
    WHERE c.anio = 2022
) AS a

JOIN (
    -- Datos de 2015 (año base)
    SELECT 
        c.comunidad,
        c.poblacion,
        s.salario_mediana,
        v.coste_medio
    FROM censo AS c
    JOIN salarios AS s USING (comunidad, anio)
    JOIN coste_vivienda AS v USING (comunidad, anio)
    WHERE c.anio = 2015
) AS b
  ON a.comunidad = b.comunidad

ORDER BY a.comunidad;




-- Calculamos la relacion entre el salario mediano anual y el precio medio €/m2 de la vivienda
-- al que llamaremos "Indice de asequibilidad":

SELECT 
    cv.comunidad,
    cv.anio,
    cv.coste_medio,          -- €/m²
    s.salario_mediana,       -- € anuales (mediana)
    ROUND(s.salario_mediana / NULLIF(cv.coste_medio, 0), 2) AS indice_asequibilidad_m2
FROM coste_vivienda AS cv
JOIN salarios AS s
  USING (comunidad, anio)
ORDER BY cv.comunidad, cv.anio;




-- Calculamos la relacion entre  la poblacion cada 1000 habitantes (como demanda potencial) y el nº de hiptoecas concedidas
-- al que llamaremos "Indice de demanda potencial":

SELECT 
    h.comunidad,
    h.anio,
    h.n_hipotecas,
    c.poblacion,
    ROUND(ROUND(NULLIF(c.poblacion, 0) / h.n_hipotecas, 2) /100, 1) AS indice_demanda_potencial
FROM hipotecas AS h
JOIN censo AS c
  ON h.comunidad = c.comunidad
 AND h.anio = c.anio
ORDER BY h.comunidad, h.anio;
